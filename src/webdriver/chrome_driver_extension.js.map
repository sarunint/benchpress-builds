{"version":3,"file":"chrome_driver_extension.js","sourceRoot":"./","sources":["src/webdriver/chrome_driver_extension.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Inject, Injectable, StaticProvider} from '@angular/core';\n\nimport {Options} from '../common_options';\nimport {WebDriverAdapter} from '../web_driver_adapter';\nimport {PerfLogEvent, PerfLogFeatures, WebDriverExtension} from '../web_driver_extension';\n\n/**\n * Set the following 'traceCategories' to collect metrics in Chrome:\n * 'v8,blink.console,disabled-by-default-devtools.timeline,devtools.timeline,blink.user_timing'\n *\n * In order to collect the frame rate related metrics, add 'benchmark'\n * to the list above.\n */\n@Injectable()\nexport class ChromeDriverExtension extends WebDriverExtension {\n  static PROVIDERS = <StaticProvider>[{\n    provide: ChromeDriverExtension,\n    deps: [WebDriverAdapter, Options.USER_AGENT]\n  }];\n\n  private _majorChromeVersion: number;\n  private _firstRun = true;\n\n  constructor(private _driver: WebDriverAdapter, @Inject(Options.USER_AGENT) userAgent: string) {\n    super();\n    this._majorChromeVersion = this._parseChromeVersion(userAgent);\n  }\n\n  private _parseChromeVersion(userAgent: string): number {\n    if (!userAgent) {\n      return -1;\n    }\n    let v = userAgent.split(/Chrom(e|ium)\\//g)[2];\n    if (!v) {\n      return -1;\n    }\n    v = v.split('.')[0];\n    if (!v) {\n      return -1;\n    }\n    return parseInt(v, 10);\n  }\n\n  gc() { return this._driver.executeScript('window.gc()'); }\n\n  async timeBegin(name: string): Promise<any> {\n    if (this._firstRun) {\n      this._firstRun = false;\n      // Before the first run, read out the existing performance logs\n      // so that the chrome buffer does not fill up.\n      await this._driver.logs('performance');\n    }\n    return this._driver.executeScript(`performance.mark('${name}-bpstart');`);\n  }\n\n  timeEnd(name: string, restartName: string|null = null): Promise<any> {\n    let script = `performance.mark('${name}-bpend');`;\n    if (restartName) {\n      script += `performance.mark('${restartName}-bpstart');`;\n    }\n    return this._driver.executeScript(script);\n  }\n\n  // See [Chrome Trace Event\n  // Format](https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/edit)\n  readPerfLog(): Promise<PerfLogEvent[]> {\n    // TODO(tbosch): Chromedriver bug https://code.google.com/p/chromedriver/issues/detail?id=1098\n    // Need to execute at least one command so that the browser logs can be read out!\n    return this._driver.executeScript('1+1')\n        .then((_) => this._driver.logs('performance'))\n        .then((entries) => {\n          const events: PerfLogEvent[] = [];\n          entries.forEach((entry: any) => {\n            const message = JSON.parse(entry['message'])['message'];\n            if (message['method'] === 'Tracing.dataCollected') {\n              events.push(message['params']);\n            }\n            if (message['method'] === 'Tracing.bufferUsage') {\n              throw new Error('The DevTools trace buffer filled during the test!');\n            }\n          });\n          return this._convertPerfRecordsToEvents(events);\n        });\n  }\n\n  private _convertPerfRecordsToEvents(\n      chromeEvents: Array<{[key: string]: any}>, normalizedEvents: PerfLogEvent[]|null = null) {\n    if (!normalizedEvents) {\n      normalizedEvents = [];\n    }\n    chromeEvents.forEach((event) => {\n      const categories = this._parseCategories(event['cat']);\n      const normalizedEvent = this._convertEvent(event, categories);\n      if (normalizedEvent != null) normalizedEvents !.push(normalizedEvent);\n    });\n    return normalizedEvents;\n  }\n\n  private _convertEvent(event: {[key: string]: any}, categories: string[]) {\n    const name = event['name'];\n    const args = event['args'];\n    if (this._isEvent(categories, name, ['blink.console'])) {\n      return normalizeEvent(event, {'name': name});\n    } else if (this._isEvent(categories, name, ['blink.user_timing'])) {\n      return normalizeEvent(event, {'name': name});\n    } else if (this._isEvent(\n                   categories, name, ['benchmark'],\n                   'BenchmarkInstrumentation::ImplThreadRenderingStats')) {\n      // TODO(goderbauer): Instead of BenchmarkInstrumentation::ImplThreadRenderingStats the\n      // following events should be used (if available) for more accurate measurements:\n      //   1st choice: vsync_before - ground truth on Android\n      //   2nd choice: BenchmarkInstrumentation::DisplayRenderingStats - available on systems with\n      //               new surfaces framework (not broadly enabled yet)\n      //   3rd choice: BenchmarkInstrumentation::ImplThreadRenderingStats - fallback event that is\n      //               always available if something is rendered\n      const frameCount = event['args']['data']['frame_count'];\n      if (frameCount > 1) {\n        throw new Error('multi-frame render stats not supported');\n      }\n      if (frameCount == 1) {\n        return normalizeEvent(event, {'name': 'frame'});\n      }\n    } else if (\n        this._isEvent(categories, name, ['disabled-by-default-devtools.timeline'], 'Rasterize') ||\n        this._isEvent(\n            categories, name, ['disabled-by-default-devtools.timeline'], 'CompositeLayers')) {\n      return normalizeEvent(event, {'name': 'render'});\n    } else if (this._isEvent(categories, name, ['devtools.timeline', 'v8'], 'MajorGC')) {\n      const normArgs = {\n        'majorGc': true,\n        'usedHeapSize': args['usedHeapSizeAfter'] !== undefined ? args['usedHeapSizeAfter'] :\n                                                                  args['usedHeapSizeBefore']\n      };\n      return normalizeEvent(event, {'name': 'gc', 'args': normArgs});\n    } else if (this._isEvent(categories, name, ['devtools.timeline', 'v8'], 'MinorGC')) {\n      const normArgs = {\n        'majorGc': false,\n        'usedHeapSize': args['usedHeapSizeAfter'] !== undefined ? args['usedHeapSizeAfter'] :\n                                                                  args['usedHeapSizeBefore']\n      };\n      return normalizeEvent(event, {'name': 'gc', 'args': normArgs});\n    } else if (\n        this._isEvent(categories, name, ['devtools.timeline'], 'FunctionCall') &&\n        (!args || !args['data'] ||\n         (args['data']['scriptName'] !== 'InjectedScript' && args['data']['scriptName'] !== ''))) {\n      return normalizeEvent(event, {'name': 'script'});\n    } else if (this._isEvent(categories, name, ['devtools.timeline'], 'EvaluateScript')) {\n      return normalizeEvent(event, {'name': 'script'});\n    } else if (this._isEvent(\n                   categories, name, ['devtools.timeline', 'blink'], 'UpdateLayoutTree')) {\n      return normalizeEvent(event, {'name': 'render'});\n    } else if (\n        this._isEvent(categories, name, ['devtools.timeline'], 'UpdateLayerTree') ||\n        this._isEvent(categories, name, ['devtools.timeline'], 'Layout') ||\n        this._isEvent(categories, name, ['devtools.timeline'], 'Paint')) {\n      return normalizeEvent(event, {'name': 'render'});\n    } else if (this._isEvent(categories, name, ['devtools.timeline'], 'ResourceReceivedData')) {\n      const normArgs = {'encodedDataLength': args['data']['encodedDataLength']};\n      return normalizeEvent(event, {'name': 'receivedData', 'args': normArgs});\n    } else if (this._isEvent(categories, name, ['devtools.timeline'], 'ResourceSendRequest')) {\n      const data = args['data'];\n      const normArgs = {'url': data['url'], 'method': data['requestMethod']};\n      return normalizeEvent(event, {'name': 'sendRequest', 'args': normArgs});\n    } else if (this._isEvent(categories, name, ['blink.user_timing'], 'navigationStart')) {\n      return normalizeEvent(event, {'name': 'navigationStart'});\n    }\n    return null;  // nothing useful in this event\n  }\n\n  private _parseCategories(categories: string): string[] { return categories.split(','); }\n\n  private _isEvent(\n      eventCategories: string[], eventName: string, expectedCategories: string[],\n      expectedName: string|null = null): boolean {\n    const hasCategories = expectedCategories.reduce(\n        (value, cat) => value && eventCategories.indexOf(cat) !== -1, true);\n    return !expectedName ? hasCategories : hasCategories && eventName === expectedName;\n  }\n\n  perfLogFeatures(): PerfLogFeatures {\n    return new PerfLogFeatures({render: true, gc: true, frameCapture: true, userTiming: true});\n  }\n\n  supports(capabilities: {[key: string]: any}): boolean {\n    return this._majorChromeVersion >= 44 && capabilities['browserName'].toLowerCase() === 'chrome';\n  }\n}\n\nfunction normalizeEvent(chromeEvent: {[key: string]: any}, data: PerfLogEvent): PerfLogEvent {\n  let ph = chromeEvent['ph'].toUpperCase();\n  if (ph === 'S') {\n    ph = 'B';\n  } else if (ph === 'F') {\n    ph = 'E';\n  } else if (ph === 'R') {\n    // mark events from navigation timing\n    ph = 'I';\n    // Chrome 65+ doesn't allow user timing measurements across page loads.\n    // Instead, we use performance marks with special names.\n    if (chromeEvent['name'].match(/-bpstart/)) {\n      data['name'] = chromeEvent['name'].slice(0, -8);\n      ph = 'B';\n    } else if (chromeEvent['name'].match(/-bpend$/)) {\n      data['name'] = chromeEvent['name'].slice(0, -6);\n      ph = 'E';\n    }\n  }\n  const result: {[key: string]: any} =\n      {'pid': chromeEvent['pid'], 'ph': ph, 'cat': 'timeline', 'ts': chromeEvent['ts'] / 1000};\n  if (ph === 'X') {\n    let dur = chromeEvent['dur'];\n    if (dur === undefined) {\n      dur = chromeEvent['tdur'];\n    }\n    result['dur'] = !dur ? 0.0 : dur / 1000;\n  }\n  for (const prop in data) {\n    result[prop] = data[prop];\n  }\n  return result;\n}\n"]}